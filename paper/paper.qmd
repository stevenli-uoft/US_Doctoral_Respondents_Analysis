---
title: "Reflection 4 Exercise"
author: 
  - Group 52
thanks: "Code and data are available at: https://github.com/stevenli-uoft/sta304_reflection4"
date: today
date-format: long
format: pdf
number-sections: true
---


```{r}
#| include: false
#| warning: false
#| message: false

library(tidyverse)
library(knitr)

# Load the data
data <- read_csv(here::here("data/usa_00001.csv"))
```

# Instructions on how to obtain the data:

1. Go to https://usa.ipums.org/usa/
2. Create an account or log in
3. Select the 2022 ACS sample
4. Choose the following variables: STATEICP, EDUC, SEX
5. Submit the extract request
6. Download the data and save it as "usa_00001.csv" in a "data" folder in your project directory

# Brief Overview of the Ratio Estimators Approach
The ratio estimators approach, also known as the Laplace ratio estimator, is a statistical method used to estimate population parameters when only partial information is available. In this case, we're using it to estimate the total number of respondents in each state based on the known number of respondents with doctoral degrees.

The basic idea behind this approach is to use a known ratio from one population (in this case, California) and apply it to other populations to estimate their total size. The steps involved are:

1. Calculate the ratio of doctoral degree holders to total respondents in California. (Assume this ratio is constant across all states)
2. For each state, divide the number of doctoral degree holders by this ratio to estimate the total number of respondents.

This method relies on the assumption that the proportion of doctoral degree holders is relatively consistent across states, which may not always be true in practice.

```{r}
#| echo: false
#| warning: false
#| message: false

# Create a tibble with the count of doctoral degrees by state
doctoral_degrees_by_state <- data %>%
  group_by(STATEICP) %>%
  summarise(
    doctoral_count = sum(EDUCD == 116),
    total_count = n()
  ) %>%
  arrange(desc(doctoral_count))

# Calculate the ratio for California
ca_ratio <- doctoral_degrees_by_state %>%
  filter(STATEICP == 71) %>%  # 71 is the STATEICP code for California
  mutate(ratio = doctoral_count / total_count) %>%
  pull(ratio)

# Apply Laplace ratio estimator
laplace_estimate <- doctoral_degrees_by_state %>%
  mutate(
    estimated_total = doctoral_count / ca_ratio,
    difference = total_count - estimated_total,
    percent_difference = (difference / total_count) * 100
  )


# Summary statistics
summary_stats <- laplace_estimate %>%
  summarise(
    mean_difference = mean(difference),
    median_difference = median(difference),
    mean_percent_difference = mean(percent_difference),
    median_percent_difference = median(percent_difference)
  )
```

# Estimates and Actual Number of Respondents
@tbl-laplace_estimates presents the total doctoral count, total respondents, and estimated respondent count for every state.
```{r}
#| label: tbl-laplace_estimates
#| tbl-cap: "State Doctoral and Respondant Counts, and Estimates"
#| echo: false
#| warning: false
#| message: false

colnames(laplace_estimate) <- c("STATEICP", "Actual Doctoral Count", 
                                "Total Respondent", "Estimated Respondent Count",
                                "Difference", "% Difference")

kable(laplace_estimate)
```

@tbl-summary_stats shows the summary statistics of @tbl-laplace_estimates, highlighting a mean difference of 19.56%.

```{r}
#| label: tbl-summary_stats
#| tbl-cap: "Laplace Estimation Summary Statistics"
#| echo: false
#| warning: false
#| message: false

colnames(summary_stats) <- c("Mean Difference", "Median Difference", 
                                "Mean Percent Difference", 
                             "Median Percent Difference")

kable(summary_stats)
```

# Explanation of Differences
Our estimates using the Laplace ratio estimator show some notable differences from the actual numbers of respondents in each state. Here are the key points to consider:

- Magnitude of differences: On average, our estimates differed from the actual numbers by about 12,785 respondents (mean difference), with a median difference of 10,122. This suggests that while some states had larger discrepancies, the typical difference was around 10,000 respondents.
- Variation in education levels: The primary reason for these differences is likely the variation in educational attainment across states. Our method assumed a constant ratio of doctoral degree holders to total population based on California's data. However, this ratio almost certainly varies between states due to differences in economic structures, presence of research institutions, and demographic compositions.


These findings highlight the limitations of applying a single ratio estimator across diverse populations and emphasize the need for more nuanced approaches when estimating population parameters across different regions.